<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="author" content="JoBackRer"><meta name="copyright" content="JoBackRer"><meta name="theme-color" content="#FFB347"><meta name="format-detection" content="telephone=no"><meta name="keywords" content="pfc,ca,mc,mod"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="application-name" content="实体 API (cbs) | JoBackRer の blog"><meta name="apple-mobile-web-app-title" content="实体 API (cbs) | JoBackRer の blog"><meta name="apple-mobile-web-app-status-bar-style" content="#FFB347"><link rel="canonical" href="https://www.jobackrer.site/posts/12320b39/"><meta name="description" content="ClassBioArsenal 实体机制（Entity System）API 说明本文档介绍如何针对 ClassBioArsenal 的 实体机制系统 进行二次开发，包括：  使用 Java 端 MechanicsAPI 读取 &#x2F; 修改实体等级、实体词条等运行时数据； 基于 JSON（entity_system）定义的机制在 Java 中的等价操作； 在 Java 中动态注册新的实体词条定义..."><meta property="og:type" content="article"><meta property="og:title" content="实体 API (cbs) | JoBackRer の blog"><meta property="og:url" content="https://www.jobackrer.site/posts/12320b39/index.html"><meta property="og:site_name" content="JoBackRer の blog"><meta property="og:description" content="ClassBioArsenal 实体机制（Entity System）API 说明本文档介绍如何针对 ClassBioArsenal 的 实体机制系统 进行二次开发，包括：  使用 Java 端 MechanicsAPI 读取 &#x2F; 修改实体等级、实体词条等运行时数据； 基于 JSON（entity_system）定义的机制在 Java 中的等价操作； 在 Java 中动态注册新的实体词条定义..."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.jobackrer.site/posts/12320b39/assets/images/Hexo-Theme-MEOW.png"><meta property="article:published_time" content="2025-12-12T10:12:45.000Z"><meta property="article:modified_time" content="2025-12-12T10:43:00.459Z"><meta property="article:author" content="JoBackRer"><meta property="article:tag" content="ca"><meta property="article:tag" content="mc"><meta property="article:tag" content="mod"><meta property="article:tag" content="pfc"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://www.jobackrer.site/posts/12320b39/assets/images/Hexo-Theme-MEOW.png"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><title>实体 API (cbs) | JoBackRer の blog</title><link rel="icon shortcut" href="/assets/images/Hexo-Theme-MEOW.ico"><link rel="preconnect" href="/assets"><link rel="preconnect" href="assets"><link rel="stylesheet" href="/css/style.css"><link rel="prefetch" href="/"><link rel="prefetch" href="/archives"><link rel="prefetch" href="/tags"><meta name="generator" content="Hexo 8.1.1"></head><body bg-style="none"><header><div id="navbar"><div id="nav-info"><a id="site-icon" href="/" title="主页"><img src="/assets/images/Hexo-Theme-MEOW.png" alt="Logo"></a><a id="site-name" href="/" title="主页"><div>JoBackRer の blog</div><img src="/assets/images/svg/uc/uc-home.svg" class="icon noview" alt="Icon"></a></div><div id="nav-menu"><div class="menu-item"><a href="javascript:void(0);"><img src="/assets/images/svg/uc/uc-article.svg" class="icon noview" alt="Icon"><span>文章</span></a><ul class="sub-menu-item"><li><a href="/archives"><img src="/assets/images/svg/uc/uc-archive.svg" class="icon noview" alt="Icon"><span>归档</span></a></li><li><a href="/categories"><img src="/assets/images/svg/uc/uc-category.svg" class="icon noview" alt="Icon"><span>分类</span></a></li><li><a href="/tags"><img src="/assets/images/svg/uc/uc-tag.svg" class="icon noview" alt="Icon"><span>标签</span></a></li></ul></div><div class="menu-item"><a href="javascript:void(0);"><img src="/assets/images/svg/uc/uc-face.svg" class="icon noview" alt="Icon"><span>我的</span></a><ul class="sub-menu-item"><li><a href="/assets/page/about.html"><img src="/assets/images/svg/uc/uc-about.svg" class="icon noview" alt="Icon"><span>关于</span></a></li><li><a href="/friends"><img src="/assets/images/svg/uc/uc-friend.svg" class="icon noview" alt="Icon"><span>友情链接</span></a></li><li><a href="/essay"><img src="/assets/images/svg/uc/uc-gift.svg" class="icon noview" alt="Icon"><span>动态</span></a></li></ul></div><div class="menu-item"><a href="javascript:void(0);"><img src="/assets/images/svg/uc/uc-sun.svg" class="icon noview" alt="Icon"><span>小玩意</span></a><ul class="sub-menu-item"><li><a href="/confession"><img src="/assets/images/svg/uc/uc-about.svg" class="icon noview" alt="Icon"><span>弹窗表白网站</span></a></li></ul></div></div><div id="nav-function"><div id="search-btn"><a href="javascript:void(0);" title="搜索" accesskey="s"><img src="/assets/images/svg/uc/uc-search.svg" class="icon noview" alt="Icon"><span>搜索</span></a></div><div id="menu-btn"><a href="javascript:void(0);" title="打开菜单"><img src="/assets/images/svg/uc/uc-menu.svg" class="icon noview" alt="Icon"></a></div></div></div></header><div id="menu-aside"><div id="menu-aside-container"><div id="menu-aside-info"><a href="/" title="主页"><img src="/assets/images/Hexo-Theme-MEOW.png" alt="Logo"></a><a href="/" title="主页">JoBackRer の blog</a></div><div class="menu-aside-item"><a href="javascript:void(0);"><img src="/assets/images/svg/uc/uc-article.svg" class="icon noview" alt="Icon"><span>文章</span></a><ul class="menu-aside-sub-item"><li><a href="/archives"><img src="/assets/images/svg/uc/uc-archive.svg" class="icon noview" alt="Icon"><span>归档</span></a></li><li><a href="/categories"><img src="/assets/images/svg/uc/uc-category.svg" class="icon noview" alt="Icon"><span>分类</span></a></li><li><a href="/tags"><img src="/assets/images/svg/uc/uc-tag.svg" class="icon noview" alt="Icon"><span>标签</span></a></li></ul></div><div class="menu-aside-item"><a href="javascript:void(0);"><img src="/assets/images/svg/uc/uc-face.svg" class="icon noview" alt="Icon"><span>我的</span></a><ul class="menu-aside-sub-item"><li><a href="/assets/page/about.html"><img src="/assets/images/svg/uc/uc-about.svg" class="icon noview" alt="Icon"><span>关于</span></a></li><li><a href="/friends"><img src="/assets/images/svg/uc/uc-friend.svg" class="icon noview" alt="Icon"><span>友情链接</span></a></li><li><a href="/essay"><img src="/assets/images/svg/uc/uc-gift.svg" class="icon noview" alt="Icon"><span>动态</span></a></li></ul></div><div class="menu-aside-item"><a href="javascript:void(0);"><img src="/assets/images/svg/uc/uc-sun.svg" class="icon noview" alt="Icon"><span>小玩意</span></a><ul class="menu-aside-sub-item"><li><a href="/confession"><img src="/assets/images/svg/uc/uc-about.svg" class="icon noview" alt="Icon"><span>弹窗表白网站</span></a></li></ul></div><hr></div></div><main><div class="banner"><div class="banner-info"><div class="banner-avatar"><img src="/assets/img/au.png" alt="Avatar"></div><div class="banner-title">「 Blog 」</div></div></div><div class="post-container"><div class="post-main"><div class="post-content"><h1 class="post-title">实体 API (cbs)</h1><div class="post-author"><span>作者: JoBackRer</span></div><div class="post-meta"><div class="post-info"><div class="post-date"><div class="post-pubdate"><img src="/assets/images/svg/ta/ta-pubdate.svg" class="icon noview" alt="Icon"><span>发表于2025-12-12</span></div><div class="post-update"><img src="/assets/images/svg/ta/ta-update.svg" class="icon noview" alt="Icon"><span>更新于2025-12-12</span></div></div><div class="post-read"><div class="post-wordcount"><img src="/assets/images/svg/ta/ta-write.svg" class="icon noview" alt="Icon"><span>总字数: 2.5k字</span></div><div class="post-readtime"><img src="/assets/images/svg/ta/ta-time.svg" class="icon noview" alt="Icon"><span>阅读时长: 8分钟</span></div></div></div><div class="post-attribute"><div class="post-categories"><img src="/assets/images/svg/ta/ta-category.svg" class="icon noview" alt="Icon"><span><a class="post-categories-link" href="/categories/pfc/">pfc</a><a class="post-categories-link" href="/categories/pfc/ca/">ca</a></span></div><div class="post-tags"><img src="/assets/images/svg/ta/ta-tag.svg" class="icon noview" alt="Icon"><span><a class="post-tags-link" href="/tags/ca/" rel="tag">ca</a><a class="post-tags-link" href="/tags/mc/" rel="tag">mc</a><a class="post-tags-link" href="/tags/mod/" rel="tag">mod</a><a class="post-tags-link" href="/tags/pfc/" rel="tag">pfc</a></span></div></div></div><div class="markdown post" indent="false"><h1 id="ClassBioArsenal-实体机制（Entity-System）API-说明"><a href="#ClassBioArsenal-实体机制（Entity-System）API-说明" class="headerlink" title="ClassBioArsenal 实体机制（Entity System）API 说明"></a>ClassBioArsenal 实体机制（Entity System）API 说明</h1><p>本文档介绍如何针对 ClassBioArsenal 的 <strong>实体机制系统</strong> 进行二次开发，包括：</p> <ul> <li>使用 Java 端 <code>MechanicsAPI</code> 读取 / 修改实体等级、实体词条等运行时数据；</li> <li>基于 JSON（<code>entity_system</code>）定义的机制在 Java 中的等价操作；</li> <li>在 Java 中动态注册新的实体词条定义、实体配置和掉落规则。</li> </ul> <blockquote> <p>说明：以下内容基于 Forge 1.20.1。</p> </blockquote> <hr> <h2 id="1-Java-MechanicsAPI"><a href="#1-Java-MechanicsAPI" class="headerlink" title="1. Java MechanicsAPI"></a>1. Java MechanicsAPI</h2><p>对外入口类：</p> <ul> <li>包名：<code>site.backrer.classbioarsenal.api</code></li> <li>类名：<code>MechanicsAPI</code></li> </ul> <p>只要在运行时依赖 ClassBioArsenal 的 jar，就可以在你的模组中直接调用这些静态方法。</p> <h3 id="1-1-实体基础数据与-EntityData-能力"><a href="#1-1-实体基础数据与-EntityData-能力" class="headerlink" title="1.1 实体基础数据与 EntityData 能力"></a>1.1 实体基础数据与 EntityData 能力</h3><ul> <li><p><code>@Nullable String getEntityId(LivingEntity entity)</code><br>返回实体注册 ID（例如 <code>minecraft:zombie</code>、<code>classbioarsenal:xxx</code>）。</p> </li> <li><p><code>@Nullable EntityData getEntityData(LivingEntity entity)</code><br>返回实体附加的 <code>EntityData</code> 能力对象；仅对 <strong>非玩家 LivingEntity</strong> 附加，<br>玩家不会有该能力。</p> </li> <li><p><code>boolean hasEntityData(LivingEntity entity)</code><br>检查实体是否拥有 <code>EntityData</code> 能力。</p> </li> </ul> <h3 id="1-2-运行时：实体等级与词条"><a href="#1-2-运行时：实体等级与词条" class="headerlink" title="1.2 运行时：实体等级与词条"></a>1.2 运行时：实体等级与词条</h3><ul> <li><p><code>int getEntityLevel(LivingEntity entity)</code><br>获取实体等级；如果未初始化或无 <code>EntityData</code>，返回 <code>0</code>。</p> </li> <li><p><code>void setEntityLevel(LivingEntity entity, int level, boolean refreshAttributes)</code><br>设置实体等级，并可选是否立即调用内部的 <code>EntityEventHandler.applyAttributes</code> 来刷新等级带来的属性加成。</p> </li> <li><p><code>Map&lt;String, Integer&gt; getEntityAffixLevels(LivingEntity entity)</code><br>获取实体当前所有词条的 <code>(affixId -&gt; level)</code> 映射；<br>词条 ID 一般为形如 <code>classbioarsenal:tag_cold</code> 的字符串。</p> </li> <li><p><code>boolean hasEntityAffix(LivingEntity entity, String affixId)</code><br>检查实体是否拥有某个词条。</p> </li> <li><p><code>int getEntityAffixLevel(LivingEntity entity, String affixId)</code><br>获取实体指定词条等级；不存在则返回 <code>0</code>。</p> </li> <li><p><code>void addOrSetEntityAffix(LivingEntity entity, String affixId, int level)</code><br>为实体添加或覆盖一个词条等级（直接操作 <code>EntityData</code>）。</p> </li> <li><p><code>void removeEntityAffix(LivingEntity entity, String affixId)</code><br>从实体上移除指定词条。</p> </li> </ul> <blockquote> <p>注意：</p> <ul> <li>大部分 “行为类” 实体词条（如 COLD、BRUTAL 等）会在事件中按需检查 <code>hasAffix</code> 并生效，<br>因此通过 API 新增这些词条通常立即生效。 </li> <li>少数 “属性类” 词条（如 SWIFT / UNMATCHED）的属性加成是在实体生成时应用一次，<br>若你在运行时通过 API 修改这些词条，可能需要自行重新应用属性（例如重新调用 <code>applyAttributes</code> 或编写自定义逻辑）。</li> </ul> </blockquote> <hr> <h2 id="2-配置级别：等级规则（LevelConfig）"><a href="#2-配置级别：等级规则（LevelConfig）" class="headerlink" title="2. 配置级别：等级规则（LevelConfig）"></a>2. 配置级别：等级规则（LevelConfig）</h2><p>实体等级规则由 <code>entity_system/level_config.json</code> 等 JSON 定义，对应 Java 结构为 <code>EntityConfig.LevelConfig</code>。</p> <h3 id="2-1-读取与设置维度等级规则"><a href="#2-1-读取与设置维度等级规则" class="headerlink" title="2.1 读取与设置维度等级规则"></a>2.1 读取与设置维度等级规则</h3><ul> <li><p><code>@Nullable EntityConfig.DimensionRule getLevelRule(String dimensionId)</code><br>获取某维度的等级规则；维度 ID 例如：</p> <ul> <li><code>minecraft:overworld</code></li> <li><code>minecraft:the_nether</code></li> </ul> </li> <li><p><code>void setLevelRule(String dimensionId, int baseLevel, double levelMultiplier, int distanceThreshold)</code><br>为某个维度设置或更新等级规则：</p> <ul> <li><code>baseLevel</code>：基础等级；</li> <li><code>levelMultiplier</code>：随距离增长的等级倍率；</li> <li><code>distanceThreshold</code>：距离阈值（决定多少距离提升一级）。</li> </ul> </li> </ul> <p>通过该 API 修改的规则，会影响后续新刷出的实体在 <code>EntityEventHandler.calculateLevel</code> 中的等级计算。</p> <hr> <h2 id="3-配置级别：实体词条定义（AffixSettings-affixes）"><a href="#3-配置级别：实体词条定义（AffixSettings-affixes）" class="headerlink" title="3. 配置级别：实体词条定义（AffixSettings.affixes）"></a>3. 配置级别：实体词条定义（AffixSettings.affixes）</h2><p>实体词条定义由 <code>entity_system/affix_config.json</code> 中的 <code>affixes</code> 字段管理，对应 Java 结构为 <code>EntityConfig.AffixSettings.affixes</code>。</p> <h3 id="3-1-读取实体词条定义"><a href="#3-1-读取实体词条定义" class="headerlink" title="3.1 读取实体词条定义"></a>3.1 读取实体词条定义</h3><ul> <li><p><code>Map&lt;String, EntityConfig.AffixDefinition&gt; getAllEntityAffixDefinitions()</code><br>获取所有实体词条定义（key 为词条 ID，如 <code>classbioarsenal:tag_cold</code>）。</p> </li> <li><p><code>@Nullable EntityConfig.AffixDefinition getEntityAffixDefinition(String affixId)</code><br>获取单个实体词条定义。</p> </li> </ul> <p><code>AffixDefinition</code> 结构中包含：</p> <ul> <li><code>min_level</code>：出现所需最低实体等级；</li> <li><code>base_chance</code>：基础概率；</li> <li><code>growth_per_level</code>：随实体等级增加的权重 / 概率成长；</li> <li><code>max_level</code>：该词条最大等级；</li> <li><code>params</code>：可扩展的参数 Map（由具体词条逻辑解释）；</li> <li><code>conflicts</code>：冲突词条 ID 列表。</li> </ul> <blockquote> <p>当前版本中，<code>AffixHelper.generateAffixes</code> 只使用了 <code>max_level</code> 来限制生成等级，<br>但你依然可以通过 <code>params</code> 和 <code>conflicts</code> 在自定义逻辑中使用这些字段。</p> </blockquote> <p>此外，<code>affix_config.json</code> 中还包含 <code>global_settings</code>：</p> <ul> <li><code>global_max_affixes</code>：全局最大实体词条数量；</li> <li><code>count_by_level</code>：按实体等级区间控制词条数量，例如 <code>"1-5": 1</code> 表示 1～5 级只生成 1 个词条。</li> </ul> <p>对应的 Java API 为：</p> <ul> <li><p><code>@Nullable EntityConfig.GlobalAffixSettings getGlobalAffixSettings()</code> /<br><code>void setGlobalAffixSettings(@Nullable EntityConfig.GlobalAffixSettings settings)</code><br>直接读写整个 <code>global_settings</code> 对象。</p> </li> <li><p><code>int getGlobalMaxAffixes()</code> / <code>void setGlobalMaxAffixes(int max)</code><br>读写 <code>global_max_affixes</code> 字段。</p> </li> <li><p><code>Map&lt;String, Integer&gt; getAffixCountByLevel()</code> /<br><code>void setAffixCountByLevel(@Nullable Map&lt;String, Integer&gt; counts)</code><br>读写 <code>count_by_level</code> 映射（如 <code>"1-5" -&gt; 1</code>）。</p> </li> </ul> <h3 id="3-2-在-Java-中注册实体词条定义"><a href="#3-2-在-Java-中注册实体词条定义" class="headerlink" title="3.2 在 Java 中注册实体词条定义"></a>3.2 在 Java 中注册实体词条定义</h3><ul> <li><p><code>boolean registerEntityAffix(String id, EntityConfig.AffixDefinition def)</code><br>直接注册一个完整的实体词条定义。ID 已存在时返回 <code>false</code>，不会覆盖原有配置。</p> </li> <li><p><code>boolean registerEntityAffix(String id, int minLevel, double baseChance, double growthPerLevel, int maxLevel, @Nullable Map&lt;String, Object&gt; params, @Nullable List&lt;String&gt; conflicts)</code><br>使用字段参数构造并注册一个新的词条定义。</p> </li> </ul> <blockquote> <p>建议：在配置加载完成之后（资源重载完成或服务器启动后）调用注册方法，<br>例如在你的模组 CommonSetup 阶段中 <code>enqueueWork</code> 执行。</p> </blockquote> <p>注册成功后：</p> <ul> <li>该词条会被加入 <code>EntitySystemManager.AFFIX_CONFIG.affixes</code>；</li> <li><code>AffixHelper.generateAffixes</code> 在为实体生成词条时会把它作为候选之一（受 allowed / blocked 等过滤影响）；</li> <li>你可以在事件中通过 <code>hasEntityAffix</code> / <code>getEntityAffixLevel</code> 编写该词条的行为逻辑。</li> </ul> <hr> <h2 id="4-配置级别：每个实体的-MobConfig-与掉落规则"><a href="#4-配置级别：每个实体的-MobConfig-与掉落规则" class="headerlink" title="4. 配置级别：每个实体的 MobConfig 与掉落规则"></a>4. 配置级别：每个实体的 MobConfig 与掉落规则</h2><p>实体专属配置与额外掉落规则由 <code>entity_system/entity_settings.json</code> 和 <code>entity_system/drops/*.json</code> 管理，<br>对应 Java 结构为：</p> <ul> <li><code>EntitySystemManager.ENTITY_CONFIG.mobs</code>（内联设置）；</li> <li><code>EntitySystemManager.EXTRA_DROPS</code>（按实体 ID 分组的额外掉落规则）。</li> </ul> <h3 id="4-1-读取与设置-MobConfig"><a href="#4-1-读取与设置-MobConfig" class="headerlink" title="4.1 读取与设置 MobConfig"></a>4.1 读取与设置 MobConfig</h3><ul> <li><p><code>@Nullable EntityConfig.MobConfig getMobConfig(String entityId)</code><br>获取某实体类型的配置（如 <code>minecraft:zombie</code>）。</p> </li> <li><p><code>void setMobConfig(String entityId, EntityConfig.MobConfig config)</code><br>为某实体类型设置或覆盖 MobConfig。你可以手动构造一个 <code>MobConfig</code>：</p> <ul> <li><code>enabled</code>：是否启用实体机制；</li> <li><code>health_multiplier</code> / <code>armor_multiplier</code> / <code>damage_multiplier</code>：等级对属性的倍率；</li> <li><code>max_affixes</code>：该实体最多拥有的词条数；</li> <li><code>allowed_affixes</code> / <code>blocked_affixes</code>：白名单 / 黑名单；</li> <li><code>extra_drops</code>：内联额外掉落规则；</li> <li><code>min_level</code> / <code>max_level</code>：该实体等级最小 / 最大值约束。</li> </ul> </li> </ul> <p>通过 API 设置的 MobConfig 会影响后续新刷出的实体在 <code>EntityEventHandler</code> 与 <code>AffixHelper</code> 中的：</p> <ul> <li>等级计算（最小 / 最大等级约束）；</li> <li>属性加成倍数；</li> <li>词条生成的数量和候选集；</li> <li>内联掉落规则。</li> </ul> <h3 id="4-2-读取与追加额外掉落规则"><a href="#4-2-读取与追加额外掉落规则" class="headerlink" title="4.2 读取与追加额外掉落规则"></a>4.2 读取与追加额外掉落规则</h3><ul> <li><p><code>List&lt;EntityConfig.ExtraDropRule&gt; getExtraDropRules(String entityId)</code><br>返回该实体当前综合的掉落规则：</p> <ul> <li><code>MobConfig.extra_drops</code> 中配置的规则；</li> <li><code>entity_system/drops/*.json</code> 加载到 <code>EXTRA_DROPS</code> 的规则。</li> </ul> </li> <li><p><code>void addExtraDropRule(String entityId, EntityConfig.ExtraDropRule rule, boolean asInline)</code><br>为某实体追加一个额外掉落规则：</p> <ul> <li><code>asInline = true</code>：追加到 <code>MobConfig.extra_drops</code> 中，等价于在 <code>entity_settings</code> 中内联配置；</li> <li><code>asInline = false</code>：追加到 <code>EXTRA_DROPS</code> 中，等价于在 <code>entity_system/drops/*.json</code> 中新增规则。</li> </ul> </li> </ul> <p><code>ExtraDropRule</code> 支持：</p> <ul> <li>按整体概率 <code>chance</code> 控制触发；</li> <li>按实体等级区间 <code>entity_level.min/max</code> 限制；</li> <li>按实体词条 / 词条等级条件 <code>required_affixes</code> 限制；</li> <li>掉落多个物品 <code>items</code>（支持 min / max 数量和单独概率）；</li> <li>添加额外经验 <code>extra_experience</code>；</li> <li>执行一系列命令 <code>commands</code>（支持 console / position / killer 等执行模式）。</li> </ul> <hr> <h2 id="5-示例：为僵尸追加一个自定义实体词条与掉落"><a href="#5-示例：为僵尸追加一个自定义实体词条与掉落" class="headerlink" title="5. 示例：为僵尸追加一个自定义实体词条与掉落"></a>5. 示例：为僵尸追加一个自定义实体词条与掉落</h2><blockquote> <p>以下为伪代码示意，请根据你的模组包名 / 事件注册方式自行调整。</p> </blockquote> <h3 id="5-0-通过数据包注册实体词条与掉落（可选）"><a href="#5-0-通过数据包注册实体词条与掉落（可选）" class="headerlink" title="5.0 通过数据包注册实体词条与掉落（可选）"></a>5.0 通过数据包注册实体词条与掉落（可选）</h3><p>如果你更习惯用 <strong>数据包</strong> 扩展实体机制，可以通过在数据包中添加 <code>entity_system</code> 目录下的 JSON：</p> <ol> <li>在 <code>data/yourmod/entity_system/affix_config.json</code> 中新增实体词条定义：</li> </ol> <div class="code-container" code-lang="Jsonc"><div class="codebox"><figure class="highlight jsonc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"affixes"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"yourmod:tag_shadow"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"min_level"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"base_chance"</span><span class="punctuation">:</span> <span class="number">0.1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"growth_per_level"</span><span class="punctuation">:</span> <span class="number">0.02</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"max_level"</span><span class="punctuation">:</span> <span class="number">5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"params"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">        <span class="attr">"extra_damage_per_level"</span><span class="punctuation">:</span> <span class="number">0.05</span></span><br><span class="line">      <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"conflicts"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6 9l6 6l6 -6"></path></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z"></path><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></div> <ol start="2"> <li>在 <code>data/yourmod/entity_system/entity_settings.json</code> 中为僵尸开启实体机制并允许该词条：</li> </ol> <div class="code-container" code-lang="Jsonc"><div class="codebox"><figure class="highlight jsonc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"mobs"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">    <span class="attr">"minecraft:zombie"</span><span class="punctuation">:</span> <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"enabled"</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"health_multiplier"</span><span class="punctuation">:</span> <span class="number">0.1</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"armor_multiplier"</span><span class="punctuation">:</span> <span class="number">0.05</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"damage_multiplier"</span><span class="punctuation">:</span> <span class="number">0.05</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"max_affixes"</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"allowed_affixes"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">"yourmod:tag_shadow"</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"blocked_affixes"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"excluded_mobs"</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6 9l6 6l6 -6"></path></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z"></path><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></div> <ol start="3"> <li>在 <code>data/yourmod/entity_system/drops/zombie_shadow.json</code> 中为满足条件的僵尸追加额外掉落：</li> </ol> <div class="code-container" code-lang="Jsonc"><div class="codebox"><figure class="highlight jsonc"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">{</span></span><br><span class="line">  <span class="attr">"entity_id"</span><span class="punctuation">:</span> <span class="string">"minecraft:zombie"</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">"extra_drops"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">{</span></span><br><span class="line">      <span class="attr">"chance"</span><span class="punctuation">:</span> <span class="number">0.5</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"entity_level"</span><span class="punctuation">:</span> <span class="punctuation">{</span> <span class="attr">"min"</span><span class="punctuation">:</span> <span class="number">10</span> <span class="punctuation">}</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"required_affixes"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"affix_id"</span><span class="punctuation">:</span> <span class="string">"yourmod:tag_shadow"</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">"min_level"</span><span class="punctuation">:</span> <span class="number">2</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">"items"</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">{</span></span><br><span class="line">          <span class="attr">"item"</span><span class="punctuation">:</span> <span class="string">"minecraft:diamond"</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">"min_count"</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">"max_count"</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">"chance"</span><span class="punctuation">:</span> <span class="number">1.0</span></span><br><span class="line">        <span class="punctuation">}</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">}</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6 9l6 6l6 -6"></path></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z"></path><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></div> <p>加载数据包后（<code>/reload</code> 或重启世界）：</p> <ul> <li>实体系统会通过 <code>EntitySystemManager</code> 读取这些 JSON 并加入内存配置；</li> <li>实体生成时由 <code>AffixHelper.generateAffixes</code> 决定是否给僵尸赋予 <code>yourmod:tag_shadow</code>；</li> <li>掉落时由 <code>EntityDropHandler</code> 根据 <code>extra_drops</code> 规则判断是否额外掉落钻石。</li> </ul> <p>如果你需要在 Java 端动态读 / 改这些配置，可以结合本文件前面介绍的 <code>MechanicsAPI</code> 接口（例如 <code>getEntityAffixDefinition</code>、<code>getMobConfig</code>、<code>getExtraDropRules</code> 等）。</p> <h3 id="5-1-注册一个实体词条定义-yourmod-tag-shadow"><a href="#5-1-注册一个实体词条定义-yourmod-tag-shadow" class="headerlink" title="5.1 注册一个实体词条定义 yourmod:tag_shadow"></a>5.1 注册一个实体词条定义 <code>yourmod:tag_shadow</code></h3><div class="code-container" code-lang="Java"><div class="codebox"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="class_ title">YourMod</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">MODID</span> <span class="operator">=</span> <span class="string">"your_modid"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function_ title">YourMod</span><span class="params">()</span> {</span><br><span class="line">        net.minecraftforge.fml.javafmlmod.FMLJavaModLoadingContext.get().getModEventBus()</span><br><span class="line">            .addListener(<span class="built_in">this</span>::onCommonSetup);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="function_ title">onCommonSetup</span><span class="params">(<span class="keyword">final</span> net.minecraftforge.fml.event.lifecycle.FMLCommonSetupEvent event)</span> {</span><br><span class="line">        event.enqueueWork(() -&gt; {</span><br><span class="line">            MechanicsAPI.registerEntityAffix(</span><br><span class="line">                    <span class="string">"yourmod:tag_shadow"</span>,</span><br><span class="line">                    <span class="number">1</span>,      <span class="comment">// minLevel</span></span><br><span class="line">                    <span class="number">0.1</span>,    <span class="comment">// baseChance</span></span><br><span class="line">                    <span class="number">0.02</span>,   <span class="comment">// growthPerLevel</span></span><br><span class="line">                    <span class="number">5</span>,      <span class="comment">// maxLevel</span></span><br><span class="line">                    <span class="literal">null</span>,   <span class="comment">// params，可选</span></span><br><span class="line">                    <span class="literal">null</span>    <span class="comment">// conflicts，可选</span></span><br><span class="line">            );</span><br><span class="line">        });</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6 9l6 6l6 -6"></path></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z"></path><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></div> <h3 id="5-2-在攻击事件中实现-yourmod-tag-shadow-的效果"><a href="#5-2-在攻击事件中实现-yourmod-tag-shadow-的效果" class="headerlink" title="5.2 在攻击事件中实现 yourmod:tag_shadow 的效果"></a>5.2 在攻击事件中实现 <code>yourmod:tag_shadow</code> 的效果</h3><div class="code-container" code-lang="Java"><div class="codebox"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mod</span>.EventBusSubscriber(modid = <span class="string">"your_modid"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="class_ title">ShadowAffixHandler</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">SHADOW_AFFIX</span> <span class="operator">=</span> <span class="string">"yourmod:tag_shadow"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SubscribeEvent</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="function_ title">onLivingHurt</span><span class="params">(LivingHurtEvent event)</span> {</span><br><span class="line">        <span class="keyword">if</span> (!(event.getSource().getEntity() <span class="keyword">instanceof</span> LivingEntity attacker)) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">level</span> <span class="operator">=</span> MechanicsAPI.getEntityAffixLevel(attacker, SHADOW_AFFIX);</span><br><span class="line">        <span class="keyword">if</span> (level &lt;= <span class="number">0</span>) {</span><br><span class="line">            <span class="keyword">return</span>; <span class="comment">// 攻击者没有该词条</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">LivingEntity</span> <span class="variable">target</span> <span class="operator">=</span> event.getEntity();</span><br><span class="line">        <span class="keyword">if</span> (target.level().isClientSide()) {</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="type">float</span> <span class="variable">base</span> <span class="operator">=</span> event.getAmount();</span><br><span class="line">        <span class="type">float</span> <span class="variable">extra</span> <span class="operator">=</span> base * (<span class="number">0.05f</span> * level); <span class="comment">// 每级 +5% 伤害</span></span><br><span class="line">        event.setAmount(base + extra);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 额外：施加短暂失明</span></span><br><span class="line">        target.addEffect(<span class="keyword">new</span> <span class="class_ title">MobEffectInstance</span>(MobEffects.DARKNESS, <span class="number">40</span> + level * <span class="number">10</span>, <span class="number">0</span>));</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6 9l6 6l6 -6"></path></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z"></path><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></div> <blockquote> <p>要点：</p> <ul> <li>词条生成由 <code>AffixHelper.generateAffixes</code> 决定是否赋予实体该 ID；</li> <li>你的代码只需要在事件中通过 <code>MechanicsAPI.getEntityAffixLevel</code> 判断并实现行为逻辑。</li> </ul> </blockquote> <h3 id="5-3-为僵尸追加一个额外掉落规则"><a href="#5-3-为僵尸追加一个额外掉落规则" class="headerlink" title="5.3 为僵尸追加一个额外掉落规则"></a>5.3 为僵尸追加一个额外掉落规则</h3><div class="code-container" code-lang="Java"><div class="codebox"><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="class_ title">ZombieDropConfig</span> {</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="function_ title">registerExtraDrops</span><span class="params">()</span> {</span><br><span class="line">        EntityConfig.<span class="type">ExtraDropRule</span> <span class="variable">rule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="class_ title">EntityConfig</span>.ExtraDropRule();</span><br><span class="line">        rule.chance = <span class="number">0.5</span>; <span class="comment">// 50% 概率触发</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等级条件：实体等级 &gt;= 10</span></span><br><span class="line">        EntityConfig.<span class="type">LevelCondition</span> <span class="variable">lc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="class_ title">EntityConfig</span>.LevelCondition();</span><br><span class="line">        lc.min = <span class="number">10</span>;</span><br><span class="line">        rule.entity_level = lc;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 掉落一到两颗钻石</span></span><br><span class="line">        EntityConfig.<span class="type">ExtraDropItem</span> <span class="variable">item</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="class_ title">EntityConfig</span>.ExtraDropItem();</span><br><span class="line">        item.item = <span class="string">"minecraft:diamond"</span>;</span><br><span class="line">        item.min_count = <span class="number">1</span>;</span><br><span class="line">        item.max_count = <span class="number">2</span>;</span><br><span class="line">        item.chance = <span class="number">1.0</span>; <span class="comment">// 规则触发后必定掉落</span></span><br><span class="line"></span><br><span class="line">        rule.items = java.util.List.of(item);</span><br><span class="line"></span><br><span class="line">        MechanicsAPI.addExtraDropRule(<span class="string">"minecraft:zombie"</span>, rule, <span class="literal">true</span>); <span class="comment">// 追加为内联配置</span></span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure><div class="code-fold" title="Fold/Open"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M6 9l6 6l6 -6"></path></svg></div><div class="code-copy" title="Copy"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M7 7m0 2.667a2.667 2.667 0 0 1 2.667 -2.667h8.666a2.667 2.667 0 0 1 2.667 2.667v8.666a2.667 2.667 0 0 1 -2.667 2.667h-8.666a2.667 2.667 0 0 1 -2.667 -2.667z"></path><path d="M4.012 16.737a2.005 2.005 0 0 1 -1.012 -1.737v-10c0 -1.1 .9 -2 2 -2h10c.75 0 1.158 .385 1.5 1"></path></svg></div></div></div> <hr> <h2 id="6-配置重载与调试"><a href="#6-配置重载与调试" class="headerlink" title="6. 配置重载与调试"></a>6. 配置重载与调试</h2><ul> <li><code>void reloadEntitySystemConfigs(MinecraftServer server)</code><br>手动重载 <code>entity_system</code> 下的所有 JSON 配置。<br>一般推荐使用 Minecraft 原生的资源重载机制（例如 <code>/reload</code>），本方法主要给管理工具或测试使用。</li> </ul> <p>调试建议：</p> <ol> <li>使用 <code>/reload</code> 或重启世界，确保外部数据包 / 配置被重新加载； </li> <li>在服务器日志中观察 <code>EntitySystemManager</code> 输出的 “Loaded Entity System Configs” 统计信息； </li> <li>在你的调试代码中打印 <code>MechanicsAPI.getEntityLevel</code>、<code>getEntityAffixLevels</code> 等，确认实体等级与词条是否按预期生成； </li> <li>配合 <code>EntityDropHandler</code> 的日志或实际游戏掉落，验证额外掉落规则是否生效。</li> </ol> </div><div class="post-reward"><div class="post-reward-btn" title="赞赏作者"><img src="/assets/images/svg/uc/uc-gift.svg" class="icon noview" alt="Icon"><span>喜欢这篇作品的话，奖励一下我吧～</span></div><div class="post-reward-content"><div class="post-reward-text">💗感谢你的喜欢与支持！</div><div class="post-reward-list"><a href="/null" target="_blank">致谢名单</a></div></div></div><div class="post-copyright"><div class="post-copyright-info">本作品由 JoBackRer 于 2025-12-12 18:12:45 发布</div><div class="post-copyright-link"><span>作品地址：<a href="https://www.jobackrer.site/posts/12320b39/">实体 API (cbs)</a></span><button class="copy-text" type="button" data-text="https://www.jobackrer.site/posts/12320b39/">复制</button></div><div class="post-copyright-detail">除特别声明外，本站作品均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="署名—非商业性使用—相同方式共享" target="_blank">CC BY-NC-SA 4.0</a> 许可协议，转载请注明来自 <a href="/">JoBackRer の blog</a></div><img class="noview post-copyright-icon" src="/assets/images/Hexo-Theme-MEOW.png" alt="Logo"></div><div class="post-tail-tags"><a class="post-tail-tags-link" href="/tags/ca/" rel="tag">ca</a><a class="post-tail-tags-link" href="/tags/mc/" rel="tag">mc</a><a class="post-tail-tags-link" href="/tags/mod/" rel="tag">mod</a><a class="post-tail-tags-link" href="/tags/pfc/" rel="tag">pfc</a></div></div><aside id="post-sidebar" status="show"><div id="toc-container"><div class="toc-title"><img src="/assets/images/svg/ta/ta-toc.svg" class="icon noview" alt="Icon"><span>目录</span></div><div class="toc-content" id="toc-div"><ol class="toc-list"><li class="toc-list-item toc-list-level-1"><a class="toc-list-link" href="#ClassBioArsenal-%E5%AE%9E%E4%BD%93%E6%9C%BA%E5%88%B6%EF%BC%88Entity-System%EF%BC%89API-%E8%AF%B4%E6%98%8E"><span class="toc-list-text">ClassBioArsenal 实体机制（Entity System）API 说明</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#1-Java-MechanicsAPI"><span class="toc-list-text">1. Java MechanicsAPI</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#1-1-%E5%AE%9E%E4%BD%93%E5%9F%BA%E7%A1%80%E6%95%B0%E6%8D%AE%E4%B8%8E-EntityData-%E8%83%BD%E5%8A%9B"><span class="toc-list-text">1.1 实体基础数据与 EntityData 能力</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#1-2-%E8%BF%90%E8%A1%8C%E6%97%B6%EF%BC%9A%E5%AE%9E%E4%BD%93%E7%AD%89%E7%BA%A7%E4%B8%8E%E8%AF%8D%E6%9D%A1"><span class="toc-list-text">1.2 运行时：实体等级与词条</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#2-%E9%85%8D%E7%BD%AE%E7%BA%A7%E5%88%AB%EF%BC%9A%E7%AD%89%E7%BA%A7%E8%A7%84%E5%88%99%EF%BC%88LevelConfig%EF%BC%89"><span class="toc-list-text">2. 配置级别：等级规则（LevelConfig）</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#2-1-%E8%AF%BB%E5%8F%96%E4%B8%8E%E8%AE%BE%E7%BD%AE%E7%BB%B4%E5%BA%A6%E7%AD%89%E7%BA%A7%E8%A7%84%E5%88%99"><span class="toc-list-text">2.1 读取与设置维度等级规则</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#3-%E9%85%8D%E7%BD%AE%E7%BA%A7%E5%88%AB%EF%BC%9A%E5%AE%9E%E4%BD%93%E8%AF%8D%E6%9D%A1%E5%AE%9A%E4%B9%89%EF%BC%88AffixSettings-affixes%EF%BC%89"><span class="toc-list-text">3. 配置级别：实体词条定义（AffixSettings.affixes）</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#3-1-%E8%AF%BB%E5%8F%96%E5%AE%9E%E4%BD%93%E8%AF%8D%E6%9D%A1%E5%AE%9A%E4%B9%89"><span class="toc-list-text">3.1 读取实体词条定义</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#3-2-%E5%9C%A8-Java-%E4%B8%AD%E6%B3%A8%E5%86%8C%E5%AE%9E%E4%BD%93%E8%AF%8D%E6%9D%A1%E5%AE%9A%E4%B9%89"><span class="toc-list-text">3.2 在 Java 中注册实体词条定义</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#4-%E9%85%8D%E7%BD%AE%E7%BA%A7%E5%88%AB%EF%BC%9A%E6%AF%8F%E4%B8%AA%E5%AE%9E%E4%BD%93%E7%9A%84-MobConfig-%E4%B8%8E%E6%8E%89%E8%90%BD%E8%A7%84%E5%88%99"><span class="toc-list-text">4. 配置级别：每个实体的 MobConfig 与掉落规则</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#4-1-%E8%AF%BB%E5%8F%96%E4%B8%8E%E8%AE%BE%E7%BD%AE-MobConfig"><span class="toc-list-text">4.1 读取与设置 MobConfig</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#4-2-%E8%AF%BB%E5%8F%96%E4%B8%8E%E8%BF%BD%E5%8A%A0%E9%A2%9D%E5%A4%96%E6%8E%89%E8%90%BD%E8%A7%84%E5%88%99"><span class="toc-list-text">4.2 读取与追加额外掉落规则</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#5-%E7%A4%BA%E4%BE%8B%EF%BC%9A%E4%B8%BA%E5%83%B5%E5%B0%B8%E8%BF%BD%E5%8A%A0%E4%B8%80%E4%B8%AA%E8%87%AA%E5%AE%9A%E4%B9%89%E5%AE%9E%E4%BD%93%E8%AF%8D%E6%9D%A1%E4%B8%8E%E6%8E%89%E8%90%BD"><span class="toc-list-text">5. 示例：为僵尸追加一个自定义实体词条与掉落</span></a><ol class="toc-list-child"><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#5-0-%E9%80%9A%E8%BF%87%E6%95%B0%E6%8D%AE%E5%8C%85%E6%B3%A8%E5%86%8C%E5%AE%9E%E4%BD%93%E8%AF%8D%E6%9D%A1%E4%B8%8E%E6%8E%89%E8%90%BD%EF%BC%88%E5%8F%AF%E9%80%89%EF%BC%89"><span class="toc-list-text">5.0 通过数据包注册实体词条与掉落（可选）</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#5-1-%E6%B3%A8%E5%86%8C%E4%B8%80%E4%B8%AA%E5%AE%9E%E4%BD%93%E8%AF%8D%E6%9D%A1%E5%AE%9A%E4%B9%89-yourmod-tag-shadow"><span class="toc-list-text">5.1 注册一个实体词条定义 yourmod:tag_shadow</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#5-2-%E5%9C%A8%E6%94%BB%E5%87%BB%E4%BA%8B%E4%BB%B6%E4%B8%AD%E5%AE%9E%E7%8E%B0-yourmod-tag-shadow-%E7%9A%84%E6%95%88%E6%9E%9C"><span class="toc-list-text">5.2 在攻击事件中实现 yourmod:tag_shadow 的效果</span></a></li><li class="toc-list-item toc-list-level-3"><a class="toc-list-link" href="#5-3-%E4%B8%BA%E5%83%B5%E5%B0%B8%E8%BF%BD%E5%8A%A0%E4%B8%80%E4%B8%AA%E9%A2%9D%E5%A4%96%E6%8E%89%E8%90%BD%E8%A7%84%E5%88%99"><span class="toc-list-text">5.3 为僵尸追加一个额外掉落规则</span></a></li></ol></li><li class="toc-list-item toc-list-level-2"><a class="toc-list-link" href="#6-%E9%85%8D%E7%BD%AE%E9%87%8D%E8%BD%BD%E4%B8%8E%E8%B0%83%E8%AF%95"><span class="toc-list-text">6. 配置重载与调试</span></a></li></ol></li></ol></div></div></aside></div></div><div id="toolbar" hide><div id="toolbar-setting-container" hide><div class="toolbar-item"><button id="tool-color-mode" title="深色模式" type="button"><img src="/assets/images/svg/ta/ta-moon.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button class="copy-text" id="tool-share" title="分享" type="button" data-text="https://www.jobackrer.site/posts/12320b39/"><img src="/assets/images/svg/ta/ta-share.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-font-size-plus" title="放大字体" type="button"><img src="/assets/images/svg/ta/ta-text-plus.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-font-size-minus" title="缩小字体" type="button"><img src="/assets/images/svg/ta/ta-text-minus.svg" class="icon noview" alt="Icon"></button></div></div><div class="toolbar-container"><div class="toolbar-item"><button id="tool-setting" title="设置" type="button"><img src="/assets/images/svg/ta/ta-setting.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-toc" title="目录" type="button"><img src="/assets/images/svg/ta/ta-toc.svg" class="icon noview" alt="Icon"></button></div><div class="toolbar-item"><button id="tool-gototop" title="返回顶部" type="button"><img src="/assets/images/svg/ta/ta-up.svg" class="icon noview" alt="Icon"></button></div></div></div><div class="search-overlay"><div class="search-container"><div class="search-header"><div class="search-title"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"></path><path d="M21 21l-6 -6"></path></svg> 搜索</div><div class="search-close-btn"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 21a9 9 0 0 0 9 -9a9 9 0 0 0 -9 -9a9 9 0 0 0 -9 9a9 9 0 0 0 9 9z"></path><path d="M9 8l6 8"></path><path d="M15 8l-6 8"></path></svg></div></div><div class="search-input-box"><input id="search-input" type="search" placeholder="请输入关键词进行站内搜索……" maxlength="80"></div><div class="search-result-container"><div class="search-result-icon"><svg xmlns="http://www.w3.org/2000/svg" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M10 10m-7 0a7 7 0 1 0 14 0a7 7 0 1 0 -14 0"></path><path d="M21 21l-6 -6"></path></svg></div></div></div></div></main><footer><div class="footer"><div id="footer-copyright">© 2025 <span>💗</span> <a href="/assets/page/about.html">JoBackRer</a></div><div id="footer-info"><div id="footer-framework">🚀本站由 <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/chanwj/hexo-theme-meow" title="3.2.0" target="_blank">Meow</a> 强力驱动</div><div id="footer-runtime"><span id="runtime" data-startdate="2025-11-05T22:16:20.000Z">🌻已稳定运行.年.月.天</span></div></div><div id="footer-statistic"><span>共撰写19篇文章，全站共38.7k字</span></div><div id="footer-pageview"><div id="container_site_pv"><span>🔥总访问量</span><span id="vercount_value_site_pv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 6l0 -3"></path><path d="M16.25 7.75l2.15 -2.15"></path><path d="M18 12l3 0"></path><path d="M16.25 16.25l2.15 2.15"></path><path d="M12 18l0 3"></path><path d="M7.75 16.25l-2.15 2.15"></path><path d="M6 12l-3 0"></path><path d="M7.75 7.75l-2.15 -2.15"></path></svg></span></div><div id="container_site_uv"><span>🐈访客人数</span><span id="vercount_value_site_uv"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewbox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"></path><path d="M12 6l0 -3"></path><path d="M16.25 7.75l2.15 -2.15"></path><path d="M18 12l3 0"></path><path d="M16.25 16.25l2.15 2.15"></path><path d="M12 18l0 3"></path><path d="M7.75 16.25l-2.15 2.15"></path><path d="M6 12l-3 0"></path><path d="M7.75 7.75l-2.15 -2.15"></path></svg></span></div></div></div></footer><div class="scripts"><script>const GLOBALCONFIG = {
  root: '/',
  toolbar: true,
  lazyload_src: '/assets/images/Meow-Loading.webp',
  friends: false,
  codeblock: true,
  share_text: '🐱Share From Meow',
  onblur_title: '再回来看看吧～✧(´▽`ʃ♡ƪ)',
  mouse_click: true,
  notify:{
    enable: false,
    info: '复制成功～转载请标注本文地址',
    f12_info: '开发者模式已打开，请遵循本站版权协议'
  },
  search: {
    enable: true,
    path: 'search.json',
    local: {
      top_n_per_article: 1,
      preload: false
    }
  },
  encrypt: false,
};
</script><script>localStorage.getItem('color-mode')||localStorage.setItem('color-mode','light'),document.body.setAttribute('data-mode',localStorage.getItem('color-mode'));</script> <script src="/js/theme/tools/utils.js"></script> <script src="/js/plugins/dist/lazyload.min.js"></script> <script src="/js/plugins/view-image.min.js"></script> <script src="https://events.vercount.one/js" defer></script><script>localStorage.getItem('font-size')&&(document.querySelector('.post').style.fontSize=localStorage.getItem('font-size')+'px');</script> <script src="/js/plugins/dist/search.js"></script> <script src="/js/main.js" type="module"></script> </div></body></html>